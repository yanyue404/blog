## 正则

需要转义 [ ^ . | \ / ? \* + ()

最佳工具

- https://regex101.com/
- https://jex.im/regulex/

## 基础校验

- isUrl

```
/^htt(p|ps):\/\//.test('http://10.136.110.187:3002/tkproperty/platform/h5-editer/data/data')
```

- 验证码

```js
if (!/(\d{6}|\d{4})/.test(code)) {
  return "请输入正确的验证码";
}
let isEncrypt = (val) => /\*/.test(val);
```

- 接口、路径匹配

```js
if(/\/(?:dispatcher|presentNewTop)$/.test(response.config.url))

industr(?:y|ies) = industry | industries

const productRegex = /\/tkproperty\/(?:n?prd|channel)\/([SN][\d]+)(?:\_\d+)?\/?/i;

productRegex.test('/tkproperty/prd/S202006334/')

/被保人\((.+)\)/.test('被保人(失败啦)')
/被保人(\d+)\((.+)\)/.test('被保人 2(失败啦)')
(/^1[3456789]\d{9}$/.test(number)

!/(ecuat\.tk\.cn|muat\.taikanglife\.com|localhost|upaytest\.tk\.cn|m-tk-cn-test-wh-tkc\.tk\.cn)/.test(host())

export function isPC() {
  return !/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent);
}
```

- 匹配时间

```js
// 24 小时制时间
/^([01]\d|2[0-3]):[0-5]\d$/.test('23:59')

// 日期
/\d{4}-[0-2]\d-[0-3]\d/.test('2021-12-31')
```

- 匹配非数字 18

```js
/^(?!18$)\d+/.test('18') // false
/^(?!18$)\d+/.test('24') // true
/^(?!18$)\d+/.test('1') // true
/^(?!18$)\d+/.test('182') // true
```

- fromId 格式

```js
// fromId 满足 5 位数字或数字3
/^\d{5}$|^3$/.test("111"); // false
```

- 匹配链接地址

```js
let reg = /\/tkproperty\/(?:n?prd|channel|ksh)\/(?:[SN][\d]+)(?:[_-]\d+){0,2}(?:\/$|$|\/\?)/i;

// test string
http://m.tk.cn/tkproperty/nprd/S20200257_111/?important=A
http://m.tk.cn/tkproperty/nprd/S20200257/?important=A
https://ftest.tk.cn/tkproperty/ksh/N20210022-80-116/
```

## 提取有效信息

- 取 ua 版本

```js
let ua = `UA: Mozilla/5.0 (iPhone; CPU iPhone OS 14_5_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 matrixstyle/0 SP-engine/0.0.0 main%2F1.0 matrixstyle/0 flyflow/5.7.1.30 info baiduboxapp/5.7.1.30 (Baidu; P2 14.5.1) NABar/1.0 webCore=0x10e69a9b0`;

let matches = ua.match(/(?:\(Baidu;\sP2\s)(.*?)\)/) || [];
console.log(matches[1]); // 14.5.1

let url = `http://www.wuhuepb.gov.cn/WebFileDb/NewFile/201407010837081010.pdf`;
let name = "";
if (/.*\/(.+)\.pdf$/.test(href)) {
  name = url.match(/.*\/(.+)\.pdf$/)[1];
}

console.log(name); // 201407010837081010
```

- 提取标签属性

```js
// 匹配 id
// 1
let regex = /id=".*?"/; // 想想为什么要加? 不加的话 连后面的class都会匹配到
let string = '<div id="container" class="main"></div>';
console.log(string.match(regex)[0]);
// 2
let regex = /id="[^"]*"/;
let string = '<div id="container" class="main"></div>';
console.log(string.match(regex)[0]);
```

- 检查 MAC 地址

网络接口的 MAC 地址 由 6 个以冒号分隔的两位十六进制数字组成。

例如：'01:32:54:67:89:AB'。

编写一个检查字符串是否为 MAC 地址的正则表达式。

用例：

```js
let regexp = /[0-9-A-F]{2}(:[0-9-A-F]{2}){5}/;

alert(regexp.test("01:32:54:67:89:AB")); // true

alert(regexp.test("0132546789AB")); // false (没有冒号分隔)

alert(regexp.test("01:32:54:67:89")); // false (5 个数字，必须为 6 个)

alert(regexp.test("01:32:54:67:89:ZZ")); // false (尾部为 ZZ)
```

- 提取颜色

找出形如 #abc 或 abcdef 的颜色值。即 `#`后面跟着 3 个或 6 个十六进制的数字。

```js
let regexp = /#([a-f0-9]{3}){1,2}\b/gi;

let str = "color: #3f3; background-color: #AA00ef; and: #abcd";

alert(str.match(regexp)); // #3f3 #AA00ef
```

- 颜色转换

```js
let code = `background: #000000B3;border: 1px solid #0003;`;

function hexToRgba(str) {
  let arr;
  if (str.length == 4) {
    arr = str.split("").map((c) => c + c);
  } else {
    arr = [str.slice(0, 2), str.slice(2, 4), str.slice(4, 6), str.slice(6, 8)];
  }
  let [r, g, b, a] = arr.map((n) => parseInt(n, 16));
  a = parseInt((a * 1000) / 256) / 1000;
  return `rgba(${r}, ${g}, ${b}, ${a})`;
}

code = code.replace(/#([0-9A-Fa-f]{8}|[0-9A-Fa-f]{4})\b/g, ($, $1) => {
  let v = hexToRgba($1);
  return v;
});

console.log(code); // background: rgba(0, 0, 0, 0.699);border: 1px solid rgba(0, 0, 0, 0.199);
```

- 找出所有数字

编写一个正则表达式，找出所有十进制数字，包括整数、浮点数和负数。

用例：

```js
let regexp = /你的正则表达式/g;

let str = "-1.5 0 2 -123.4.";

alert(str.match(regexp)); // -1.5, 0, 2, -123.4
```

解决方案带有可选小数部分的正数：`\d+(\.\d+)?`。
让我们在开头加上可选的 -：

```js
let regexp = /-?\d+(\.\d+)?/g;

let str = "-1.5 0 2 -123.4.";

alert(str.match(regexp)); // -1.5, 0, 2, -123.4
```

- 找出算术式子

一个算术表达式由 2 个数字和一个它们之间的运算符组成，例如：

```
1 + 2
1.2 * 3.4
-3 / -6
-2 - 2
```

运算符为 "+"、"-"、"\*" 或 "/" 中之一。

在开头、之间的部分或末尾可能有额外的空格。

创建一个函数 `parse(expr)`，它接受一个表达式作为参数，并返回一个包含 3 个元素的数组：

1. 第一个数字
2. 运算符
3. 第二个数字

用例：

```js
let [a, op, b] = parse("1.2 * 3.4");
alert(a); // 1.2
alert(op); // *
alert(b); // 3.4
```

```js
// (\d+(?:\.\d+)?)\s*([\+\-\*\/])\s*(\d+(?:\.\d+)?)

function parse(expr) {
  let regexp = /(-?\d+(?:\.\d+)?)\s*([-+*\/])\s*(-?\d+(?:\.\d+)?)/;

  let result = expr.match(regexp);

  if (!result) return [];
  result.shift();

  return result;
}

alert(parse("-1.23 * 3.45")); // -1.23, *, 3.45
```

- 去除字符左右的空格

```js
let str = " 1 24 ";

str.replace(/(^\s*)|(\s*$)/g, "") || str.replace(/^\s+|\s+$/g, ""); // 去除左右空格 1 24
str.replace(/\s/g, ""); // 去除左右空格 124

/* /test1/ => test1
/test1/app => test1/app */

str.replace(/(^\/*)|(\/*$)/g, ""); // 去除 /
```

- 取 productId

```js
"S202002950".replace(/([SN])*([\d]{8}).*/, "$1$2"); // S20200295

// https://ftest.tk.cn/tkproperty/ksh/N20210022-80-116/
let tkProductId =
  location.pathname.lastIndexOf("ksh") !== -1
    ? location.pathname
        .slice(location.pathname.lastIndexOf("ksh") + 4)
        .replace(/(^\/*)|(\/*$)/g, "")
    : "";
```

- 新版微信公众号

```js
// 微信环境下打开微信公众号的新版链接适配，? 后参数需转义
let params = this.path.match(/https:\/\/mp\.weixin\.qq\.com\/s\?(.*)/);
if (params && params[1]) {
  this.path =
    "pages/web-page/web-page?url=https://mp.weixin.qq.com/s?" +
    encodeURIComponent(params[1]);
}
```

## 基础校验

- 手机号

1、以 13|15|16|14|18|17|19 为开头的 11 为数字
2、手机号不能为空；
3、后 9 位不能出现连号

```js
export const mobile = function (number = "") {
  if (number.length == 0) {
    return "手机号码不能为空";
  }
  if (!/^1[3456789]\d{9}$/.test(number)) {
    if (number.length != 11) {
      return "请输入11位手机号";
    }
    return "手机号码格式不符合规范，请重新填写";
  }
  if (/(123456789|987654321)$/.test(number)) {
    return "手机号码不能连续";
  }
};
```

- 姓名

1. 姓名不能为空
2. 长度：3-50 个字符（中文字符算两位）
3. 连续多个特殊字符保留一个， 特殊字符两边去除空格
4. 仅允许中文、字母、数字和•\_-
5. 不允许既有汉字又有字母

```js
// 姓名验证
const confirmReplace = function (_name = "") {
  return _name.replace(/([•.。．，、]+)/gi, "·");
};
const autoReplace = function (_name = "") {
  _name = trim(_name);
  // 连续多个特殊字符保留一个， 特殊字符两边去除空格
  _name = _name.replace(/\s*([·_-])[\s·_-]*/gi, "$1");
  // 英文只能连续一个空格 // 中文去掉全部空格
  return _name.replace(/\s+/gi, /[a-zA-Z]/.test(_name) ? " " : "");
};
export const name = function (name = "", data) {
  //必填校验
  var strlength = name.length;
  if (strlength <= 0) {
    return "姓名不能为空";
  }
  let replaced = confirmReplace(name);
  let needConfirmReplace = name !== replaced;
  name = replaced;
  //字符长度校验 中文字符算两位
  let len = Array.from(name).reduce((len, letter) => {
    return len + (letter.charCodeAt(0) > 255 ? 2 : 1);
  }, 0);
  //长度校验
  if (len < 3 || len > 50) {
    return "姓名长度需为3至50个字符（字母、数字、符号是相当于1个字符，1个汉字相当于两个字符），且不得出现数字或特殊符号。";
  }
  //仅允许中文、字母、数字和•_-
  if (!/^[\u4e00-\u9fa5\sa-zA-Z·_-]+$/.test(name)) {
    return "姓名格式不符合规范,请正确填写";
  }
  //不允许既有汉字又有字母
  if (/[\u4e00-\u9fa5]/.test(name) && /[a-zA-Z]/.test(name)) {
    return "姓名格式不符合规范,请正确填写";
  }
  //•_-不能出现在第一个或者最后一个
  if (/^[·_-]|[·_-]$/.test(name)) {
    return "姓名格式不符合规范,请正确填写";
  }
  // 识别可自动不能出现的多个连续字符
  replaced = autoReplace(name);
  let needAutoReplace = name !== replaced;
  if (needConfirmReplace) {
    return "needConfirmReplace";
  }
  if (needAutoReplace) {
    return "needAutoReplace";
  }
  return "";
};
name.confirmReplace = confirmReplace;
name.autoReplace = autoReplace;
```

- 身份证

1. 18 位数字 /17 数字 + X
2. 地区必须正确
3. 日期格式必须正确
4. 校验位

```js
// 身份证校验方法
export function idCard(idcard) {
  // 1. 只能是18位身份证号码
  if (!idcard || !/^\d{17}[\dXx]$/.test(idcard)) {
    return "请输入18位身份证号码";
  }
  // 2. 地区必须正确
  var areaCode = [
    "11",
    "12",
    "13",
    "14",
    "15",
    "21",
    "22",
    "23",
    "31",
    "32",
    "33",
    "34",
    "35",
    "36",
    "37",
    "41",
    "42",
    "43",
    "44",
    "45",
    "46",
    "50",
    "51",
    "52",
    "53",
    "54",
    "61",
    "62",
    "63",
    "64",
    "65",
    "71",
    "81",
    "82",
    "91",
  ];
  if (!areaCode.includes(idcard.substr(0, 2))) {
    return "身份证格式不正确，请重新输入";
  }
  // 3. 日期必须正确
  let [, y, m, d] = idcard.substr(6, 8).match(/([\d]{4})([\d]{2})([\d]{2})/);
  let date = new Date(`${y}-${m}-${d}`);
  if (date.getDate() !== +d) {
    return "身份证格式不正确，请重新输入";
  }
  // 4. 校验位必须正确
  let arr = idcard.split("").map((n) => +n);
  let S = [7, 9, 10, 5, 8, 4, 2].reduce(
    (s, n, i) => s + n * (arr[i] + arr[i + 10]),
    [1, 6, 3].reduce((s, n, i) => s + n * arr[7 + i], 0)
  );
  let M = +"10X98765432".substr(S % 11, 1);
  let ret = M.toString() === arr[17].toString();
  return ret ? "" : "身份证格式不正确，请重新输入";
}
```

## 脱敏规则

1. 手机号

保留前 3 位和最后 4 位，其余用\*代替。

```js
value.replace(/^(\d{3})\d{4}(\d{4})$/, "$1****$2");
```

2. 姓名

3 个字以内隐藏第 1 个字，4-6 个字隐藏前 2 个字，大于 6 个字隐藏第 3-6 个字，隐藏字用\*代替；

```js
if (value.length <= 3) {
  return "*" + value.substr(1);
} else if (value.length <= 6) {
  return "**" + value.substr(2);
} else {
  return value.substr(0, 2) + "****" + value.substr(6);
}
```

3. 身份证

号码最后四位用\*替换。

```js
value.replace(/^(\d{14})\w{4}$/, "$1****");
```

## 其他

- 匹配过滤 .vue

```js
import { camelize, capitalize } from "@vue/shared";

let PropsEditer = {};
let res = import.meta.glob("./*.vue");
Object.keys(res).map((item) => {
  PropsEditer[capitalize(camelize(item.replace(/(^\.\/)|(\.vue)/g, "")))] =
    res[item];
});

export default PropsEditer;
```

- 路由扩展

```js
let item = "/auto-renewal-close";

// `@/pages${item.replace(/\/(auto-renew(?:al)?)-([\w]+)/, '/$1/$2')}.vue` => "@/pages/auto-renewal/close.vue"

// 扩展自定义路由
// 自动续费与自动续保路由结构改变，对旧有链接进行拦截
export default function (routes, resolve) {
  const routesEx = [
    "/auto-renewal-close",
    "/auto-renewal-agreement",
    "/auto-renewal-open",
    "/auto-renewal-success",
    "/auto-renew-feature",
    "/auto-renew-fail",
    "/auto-renew-redirect",
    "/auto-renew-success",
  ];
  routesEx.forEach((item) => {
    routes.push({
      path: item,
      component: resolve(
        `@/pages${item.replace(/\/(auto-renew(?:al)?)-([\w]+)/, "/$1/$2")}.vue`
      ),
    });
  });
}

let s = "John Bull";
let newStr = s.replace(/(\w+)\s(\w+)/, "$2,$1"); // "Bull,John"
```

- 链接更改

```js
let urls = [
  "https://ftest.tk.cn/tkproperty/pos/renewal-cloud/?policyId=601011019202220467266589069&policyToken=89f919f5ff3246afe2c36ea9ced80076",
  "https://ecuat.tk.cn/tk-online/pos/renewal-new/transfer-page/",
];

urls.forEach((url) => {
  url = url.replace(/((?:ftest|ecuat)\.tk\.cn)/, (_, u) => {
    return u === "ftest.tk.cn" ? "f.tk.cn" : "m.tk.cn";
  });
});
console.log(urls);
// ['https://f.tk.cn/tkproperty/pos/renewal-cloud/?policyId=601011019202220467266589069&policyToken=89f919f5ff3246afe2c36ea9ced80076', 'https://m.tk.cn/tk-online/pos/renewal-new/transfer-page/']
```

- 匹配位置

```js
\b \B
\d \D
\s \S
```

```js

// 开始与结束
'I love Rainbow.'.replace(/^/,'❤️'); // ❤️I love Rainbow.
'I love Rainbow.'.replace(/$/,'❤️'); // I love Rainbow.❤️

// \b 单词的边界
'I love Rainbow.'.replace(/\b/,'❤️'); // ❤️I❤️ ❤️love❤️ ❤️Rainbow❤️.

// \B 非单词的边界
'I love Rainbow.'.replace(/\B/,'❤️'); // I l❤️o❤️v❤️e R❤️a❤️i❤️n❤️b❤️o❤️w.❤️

// (?:p)  和直接匹配 p 差不多
'I love Rainbow.'.replace(/(?:R)/,'❤️'); // I love ❤️ainbow.


x(?=y)	前瞻肯定断言 x 被 y 跟随时匹配 x
x(?!y)	前瞻否定断言	x ，仅当后面不跟 y
(?<=y)x	后瞻肯定断言	x ，仅当跟在 y 后面
(?<!y)x	后瞻否定断言	x ，仅当不跟在 y 后面

// (?=p) 符合p子模式前面的那个位置 (正向先行断言)
'I love Rainbow.'.replace(/(?=R)/,'❤️'); // I love ❤️Rainbow.

// (?!p) 符合非p子模式前面的那个位置 (负向先行断言)
'I love Rainbow.'.replace(/(!R)/,'❤️'); // ❤️I❤️ ❤️l❤️o❤️v❤️e❤️ R❤️a❤️i❤️n❤️b❤️o❤️w❤️.❤️

// (?<=p) 符合p子模式后面(注意(?=p)表示的是前面)的那个位置
'I love Rainbow.'.replace(/(<=R)/,'❤️'); // I love R❤️ainbow.

// (?<=p)反过来的意思，可以理解为(?<=p)匹配到的位置之外的位置都是属于(?<!p)的
'I love Rainbow.'.replace(/(<!R)/,'❤️'); // ❤️I❤️ ❤️l❤️o❤️v❤️e❤️ ❤️Ra❤️i❤️n❤️b❤️o❤️w❤️.❤️
```

```js
// 单词间隔换为 ❤️，实现类似 \s
"I love Rainbow.".replace(/(?!\.)\W/, "❤️"); // I❤️love❤️Rainbow.
```

- 提取 img 信息

```js
const tabContent =
  '<p style="text-align: center;"><img href="{"app":"https://m.tk.cn/qwcrm/dl//fyiYVr","miniProgram":"https://m.tk.cn/qwcrm/h5/#/codScanning?corp_id=wwe072c386cba35e96&channelId=367412"}" src="https://mcdn.tk.cn/tkcms/file/upload/mob/productImg/S20200276/banenr@3x.png"/></a></p><p style="text-align: center;"><img src="https://mcdn.tk.cn/tkcms/ueditor/20220209/a96f4da8-f448-4862-8a2e-546759f85389.png" title="02@2x.png" _src="https://mcdn.tk.cn/tkcms/ueditor/20220209/a96f4da8-f448-4862-8a2e-546759f85389.png" alt="02@2x.png"/></p><p style="text-align: center;"><img src="https://mcdn.tk.cn/tkcms/ueditor/20220209/5400a1c2-66da-4c79-a9df-0748a2042280.png" title="03@2x.png" _src="https://mcdn.tk.cn/tkcms/ueditor/20220209/5400a1c2-66da-4c79-a9df-0748a2042280.png" alt="03@2x.png"/></p><p style="text-align: center;"><img src="https://mcdn.tk.cn/tkcms/ueditor/20220209/f11a9efa-4ebd-4ad4-95eb-66b89965746c.png" title="04@2x.png" _src="https://mcdn.tk.cn/tkcms/ueditor/20220209/f11a9efa-4ebd-4ad4-95eb-66b89965746c.png" alt="04@2x.png"/></p><p style="text-align: center;"><img src="https://mcdn.tk.cn/tkcms/ueditor/20220209/57eff387-cceb-4f9d-b885-bf097b8d2a1d.png" title="05@2x.png" _src="https://mcdn.tk.cn/tkcms/ueditor/20220209/57eff387-cceb-4f9d-b885-bf097b8d2a1d.png" alt="05@2x.png"/></p><p><img src="https://mcdn.tk.cn/tkcms/ueditor/20210429/15651ba6-29a7-4184-b5a2-30981a87f534.png" title="2021429-1405.png" _src="https://mcdn.tk.cn/tkcms/ueditor/20210429/15651ba6-29a7-4184-b5a2-30981a87f534.png" alt="2021429-1405.png"/></p>';

/**
 * 解析image标签
 * @param {String} html 待解析的html文本
 * @param {Boolean} checkHref 是否校验href链接
 */
function parseImage(html, checkHref = false) {
  let imageArray = [];
  //匹配图片
  imageArray = html.match(/<img.*?(?:>|\/>)/gi);
  imageArray = imageArray
    .map((str) => {
      //匹配链接
      let srcReg = /src=[\'\"]?([^\'\"]*)[\'\"]?/i;
      //匹配跳转链接
      let hrefReg = /href=[\'\"]?([^\'\"]*)[\'\"]?/i;
      let hrefReg__obj = /href=[\'\"]({.*})[\'\"]/i;
      let srcMatching = str.match(srcReg);
      if (srcMatching && srcMatching[1]) {
        //对于相对路径地址，是在开发环境下无法展示，添加测试环境路径
        let src = location.origin + srcMatching[1];
        let link = "";
        if (
          srcMatching[1].includes("http://") ||
          srcMatching[1].includes("https://")
        ) {
          src = srcMatching[1];
        } else {
          src =
            (location.origin.indexOf("localhost") > -1
              ? "http://ecuat.tk.cn"
              : location.origin) + srcMatching[1];
        }
        if (checkHref) {
          let hrefMatching1 = str.match(hrefReg);
          let hrefMatching2 = str.match(hrefReg__obj);
          if (hrefMatching1 && hrefMatching1[1]) {
            if (
              hrefMatching1[1].includes("http://") ||
              hrefMatching1[1].includes("https://")
            ) {
              link = hrefMatching1[1];
            } else {
              link =
                (location.origin.indexOf("localhost") > -1
                  ? "http://ecuat.tk.cn"
                  : location.origin) + hrefMatching1[1];
            }
          }
          if (hrefMatching2 && hrefMatching2[1]) {
            link = hrefMatching2[1];
          }
        }
        return {
          src,
          link,
        };
      } else {
        return false;
      }
    })
    .filter((item) => {
      //过滤掉无资源链接图片
      return item;
    });
  return imageArray;
}
```

- 提取 table 内容

```js
let trimHtml = table.replace(/\s{2,}/g, "");
const matchs = [...trimHtml.matchAll(/<td.*?>(.*?)<\/td>/g)];
const result = matchs
  .map((v) => {
    return (v && v[1]) || "";
  })
  .join("");
console.log(result);
```

## 参考链接

- https://zh.javascript.info/
- https://juejin.cn/post/7021672733213720613
- https://github.com/veedrin/horseshoe "马蹄铁"专题学习计划
- 正则表达式 30 分钟入门教程(第二版)
